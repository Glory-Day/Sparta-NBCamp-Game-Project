name: Issue & Comment Notification

on:
  issues:
    types: [opened]
  issue_comment:
    types: [created]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Slack Notification
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          ACTION="${{ github.event_name }}"
          REPO_NAME="${{ github.repository }}"
          USER="${{ github.actor }}"
          TIME=$(TZ=Asia/Seoul date +"%Y-%m-%d %H:%M:%S KST")

          if [ "$ACTION" = "issues" ]; then
            EVENT_TYPE="üìù Issue Created"
            ITEM_URL="${{ github.event.issue.html_url }}"
          else
            EVENT_TYPE="üí¨ Comment Added"
            ITEM_URL="${{ github.event.comment.html_url }}"
          fi

          # Ï†úÎ™©Ïóê URL ÎßÅÌÅ¨
          TITLE_LINK="<${ITEM_URL}|${EVENT_TYPE}>"
          # Î†àÌè¨ ÎßÅÌÅ¨
          REPO_URL="https://github.com/$REPO_NAME"
          REPO_LINK="<${REPO_URL}|${REPO_NAME}>"

          PAYLOAD=$(jq -n \
            --arg title "$TITLE_LINK" \
            --arg repo "$REPO_LINK" \
            --arg user "$USER" \
            --arg time "$TIME" \
            '{
              attachments: [
                {
                  color: "#36a64f",
                  title: $title,
                  mrkdwn_in: ["title", "fields"],
                  fields: [
                    {"title": "Repository", "value": $repo, "short": true},
                    {"title": "User", "value": $user, "short": true},
                    {"title": "Time", "value": $time, "short": true}
                  ],
                  footer: "GitHub ‚Üí Slack Notification"
                }
              ]
            }')

          curl -X POST -H 'Content-type: application/json' \
            --data "$PAYLOAD" \
            "$SLACK_WEBHOOK_URL"
